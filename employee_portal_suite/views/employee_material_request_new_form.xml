<?xml version="1.0" encoding="UTF-8"?>
<odoo>

<template id="employee_material_request_new_form" name="New Material Request Form">
<t t-call="employee_portal_suite.employee_portal_layout">

<div class="container my-4">

    <h2 class="text-center mb-4">Material Request</h2>

    <!-- Language Toggle -->
    <div class="text-end mb-3">
        <button id="btn-en" class="btn btn-primary btn-sm">ğŸ‡¬ğŸ‡§ English</button>
        <button id="btn-ar" class="btn btn-light btn-sm">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    </div>

    <!-- ===================== ENGLISH FORM ===================== -->
    <form id="form-en" method="post" action="/my/employee/material/create" enctype="multipart/form-data" style="display:block;">
        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

        <!-- Worksite -->
        <div class="form-group mt-3">
            <label>Worksite <span class="text-danger">*</span></label>
            <input type="text" name="worksite" class="form-control" required="1"/>
        </div>

        <!-- Delivery Date -->
        <div class="form-group mt-3">
            <label>Delivery Date <span class="text-danger">*</span></label>
            <input type="date" name="delivery_date" class="form-control" required="1"/>
        </div>

        <!-- MATERIAL TABLE -->
        <h4 class="mt-4">Materials</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Required Quantity</th>
                    <th>UoM</th>
                </tr>
            </thead>
            <tbody>
                <t t-foreach="range(0,10)" t-as="i">
                    <tr>
                        <td><input type="text" class="form-control" t-att-name="'item_name_%s' % i"/></td>
                        <td><input type="number" class="form-control" t-att-name="'qty_required_%s' % i"/></td>
                        <td>
                            <select class="form-control" t-att-name="'uom_id_%s' % i">
                                <option value="">Selectâ€¦</option>
                                <t t-foreach="uoms" t-as="u">
                                    <option t-att-value="u.id"><t t-esc="u.name"/></option>
                                </t>
                            </select>
                        </td>
                    </tr>
                </t>
            </tbody>
        </table>

        <!-- ========================= -->
        <!-- ATTACHMENT UPLOAD PANEL  -->
        <!-- ========================= -->
        <h4 class="mt-4">Attachments</h4>

        <!-- Tag picker -->
        <select name="attachment_tag" class="form-select mb-2" style="max-width:250px;">
            <option value="General">General</option>
            <option value="BOQ">BOQ</option>
            <option value="Quotation">Quotation</option>
            <option value="Image">Image</option>
            <option value="Receipt">Receipt</option>
        </select>

        <!-- Drag & Drop -->
        <div id="dropzone" class="border rounded p-4 text-center bg-light" style="cursor:pointer;">
            <p class="text-muted mb-0">Drag and drop files here, or click to upload</p>
            <input type="file" name="attachments" id="fileInput" class="d-none" multiple="multiple"/>
        </div>

        <!-- Preview -->
        <div id="previewArea" class="mt-3"></div>

        <button type="submit" class="btn btn-primary mt-4">Submit</button>
    </form>

    <!-- ===================== ARABIC FORM ===================== -->
    <form id="form-ar" method="post" action="/my/employee/material/create"
          enctype="multipart/form-data"
          style="display:none; direction:rtl; text-align:right;">
        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

        <div class="form-group mt-3">
            <input type="text" name="worksite" class="form-control" required="1"/>
        </div>

        <div class="form-group mt-3">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ… <span class="text-danger">*</span></label>
            <input type="date" name="delivery_date" class="form-control" required="1"/>
        </div>

        <h4 class="mt-4">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h4>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Ø§Ù„ØµÙ†Ù</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</th>
                    <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                </tr>
            </thead>
            <tbody>
                <t t-foreach="range(0,10)" t-as="i">
                    <tr>
                        <td><input type="text" class="form-control" name="item_name_{{i}}"/></td>
                        <td><input type="number" class="form-control" name="qty_required_{{i}}"/></td>
                        <td>
                            <select name="uom_id_{{i}}" class="form-control">
                                <option value="">Ø§Ø®ØªØ±â€¦</option>
                                <t t-foreach="uoms" t-as="u">
                                    <option t-att-value="u.id"><t t-esc="u.name"/></option>
                                </t>
                            </select>
                        </td>
                    </tr>
                </t>
            </tbody>
        </table>

        <!-- AR Attachments -->
        <h4 class="mt-4">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</h4>

        <select name="attachment_tag" class="form-select mb-2" style="max-width:250px;">
            <option value="General">Ø¹Ø§Ù…</option>
            <option value="BOQ">ÙƒÙ…ÙŠØ§Øª</option>
            <option value="Quotation">Ø¹Ø±Ø¶ Ø³Ø¹Ø±</option>
            <option value="Image">ØµÙˆØ±Ø©</option>
            <option value="Receipt">ÙØ§ØªÙˆØ±Ø©</option>
        </select>

        <div id="dropzone-ar" class="border rounded p-4 text-center bg-light" style="cursor:pointer;">
            <p class="text-muted mb-0">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø±ÙØ¹</p>
            <input type="file" name="attachments" id="fileInput-ar" class="d-none" multiple="multiple"/>
        </div>

        <div id="previewArea-ar" class="mt-3"></div>

        <button type="submit" class="btn btn-primary mt-4">Ø¥Ø±Ø³Ø§Ù„</button>
    </form>

</div>

<!-- ===================== JS ===================== -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    // LANGUAGE SWITCH
    document.getElementById("btn-en").onclick = function () {
        document.getElementById("form-en").style.display = "block";
        document.getElementById("form-ar").style.display = "none";
    }

    document.getElementById("btn-ar").onclick = function () {
        document.getElementById("form-en").style.display = "none";
        document.getElementById("form-ar").style.display = "block";
    }

    // Drag and Drop Logic (English)
    setupDropzone("dropzone", "fileInput", "previewArea");

    // Drag and Drop Logic (Arabic)
    setupDropzone("dropzone-ar", "fileInput-ar", "previewArea-ar");

    function setupDropzone(zoneId, inputId, previewId) {
        const dropzone = document.getElementById(zoneId);
        const fileInput = document.getElementById(inputId);
        const previewArea = document.getElementById(previewId);

        if (!dropzone || !fileInput) return;

        dropzone.addEventListener("click", () => fileInput.click());

        dropzone.addEventListener("dragover", (e) => {
            e.preventDefault();
            dropzone.classList.add("bg-warning");
        });

        dropzone.addEventListener("dragleave", () => {
            dropzone.classList.remove("bg-warning");
        });

        dropzone.addEventListener("drop", (e) => {
            e.preventDefault();
            dropzone.classList.remove("bg-warning");
            fileInput.files = e.dataTransfer.files;
            previewFiles(fileInput.files, previewArea);
        });

        fileInput.addEventListener("change", () => {
            previewFiles(fileInput.files, previewArea);
        });
    }

    function previewFiles(files, previewArea) {
        previewArea.innerHTML = "";

        for (let file of files) {
            let div = document.createElement("div");
            div.className = "mt-2";

            if (file.type.startsWith("image/")) {
                let reader = new FileReader();
                reader.onload = (e) => {
                    div.innerHTML = `
                        <img src="${e.target.result}" class="img-thumbnail" style="max-width:120px;"/>
                        <p>${file.name}</p>
                    `;
                };
                reader.readAsDataURL(file);
            }
            else if (file.type === "application/pdf") {
                div.innerHTML = `<p>ğŸ“„ PDF: ${file.name}</p>`;
            }
            else {
                div.innerHTML = `<p>ğŸ“ ${file.name}</p>`;
            }

            previewArea.appendChild(div);
        }
    }

});
</script>

</t>
</template>

</odoo>
